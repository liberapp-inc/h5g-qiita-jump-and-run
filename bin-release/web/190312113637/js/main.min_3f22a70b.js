function limit(t,e,r){return e>t?e:t>r?r:t}function random(t,e){return t+Math.random()*(e-t)}function randomInt(t,e){return t+Math.floor(Math.random()*(e-t))}var __reflect=this&&this.__reflect||function(t,e,r){t.__class__=e,r?r.push(e):r=[e],t.__types__=t.__types__?r.concat(t.__types__):r},__extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);r.prototype=e.prototype,t.prototype=new r},__awaiter=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))(function(a,o){function i(t){try{l(n.next(t))}catch(e){o(e)}}function s(t){try{l(n["throw"](t))}catch(e){o(e)}}function l(t){t.done?a(t.value):new r(function(e){e(t.value)}).then(i,s)}l((n=n.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function r(t){return function(e){return n([t,e])}}function n(r){if(a)throw new TypeError("Generator is already executing.");for(;l;)try{if(a=1,o&&(i=o[2&r[0]?"return":r[0]?"throw":"next"])&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[0,i.value]),r[0]){case 0:case 1:i=r;break;case 4:return l.label++,{value:r[1],done:!1};case 5:l.label++,o=r[1],r=[0];continue;case 7:r=l.ops.pop(),l.trys.pop();continue;default:if(i=l.trys,!(i=i.length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){l=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){l.label=r[1];break}if(6===r[0]&&l.label<i[1]){l.label=i[1],i=r;break}if(i&&l.label<i[2]){l.label=i[2],l.ops.push(r);break}i[2]&&l.ops.pop(),l.trys.pop();continue}r=e.call(t,l)}catch(n){r=[6,n],o=0}finally{a=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var a,o,i,s,l={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:r(0),"throw":r(1),"return":r(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,r){function n(n){e.call(r,n,t)}if(RES.hasRes(t)){var a=RES.getRes(t);a?n(a):RES.getResAsync(t,n,this)}else RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Scene;!function(t){t[t.Start=0]="Start",t[t.Game=1]="Game",t[t.Result=2]="Result"}(Scene||(Scene={}));var PlatformGenerationMode;!function(t){t[t.Flat=0]="Flat",t[t.SlopeAscent=1]="SlopeAscent",t[t.SlopeDescent=2]="SlopeDescent",t[t.LevelsAscent=3]="LevelsAscent",t[t.LevelsDescnet=4]="LevelsDescnet",t[t.Cliff=5]="Cliff",t[t.Pits=6]="Pits",t[t.LargePit=7]="LargePit"}(PlatformGenerationMode||(PlatformGenerationMode={}));var BALL_RADIUS=16,Main=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.colors=[3670266,7799034,11862266,15991034,14388986],e.colorGenerationIndex=0,e.platforms=[],e.ballVx=1,e.ballVy=0,e.jumpCount=0,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),this.createGameScene(),this.addEventListener(egret.Event.ENTER_FRAME,this.enterFrame,this),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.tap,this),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){return t=new LoadingUI,this.stage.addChild(t),this.stage.removeChild(t),[2]})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,r){var n=new eui.Theme("resource/default.thm.json",t.stage);n.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype.createGameScene=function(){this.createBackground(),this.createWorld(),this.createCamera(),this.createBlocks(),this.createBall(),this.createUI()},e.prototype.enterFrame=function(t){return this.updateBlocks(),this.updateBall(),this.updateCamera(),this.updateUI(),!0},e.prototype.createUI=function(){this.text=new egret.TextField,this.text.size=64,this.text.x=16,this.text.y=16,this.text.text=this.distance+"m",this.addChild(this.text)},e.prototype.updateUI=function(){this.text.text=this.distance+"m"},e.prototype.createWorld=function(){this.world=new egret.DisplayObjectContainer,this.addChild(this.world)},e.prototype.createCamera=function(){this.cameraX=-this.width},e.prototype.createBackground=function(){var t=new egret.Shape;t.x=0,t.y=0;var e=t.graphics;e.beginFill(3355443),e.drawRect(0,0,this.stage.stageWidth,this.stage.stageHeight),e.endFill(),this.addChild(t)},e.prototype.createBall=function(){this.distance=0,this.ball=new egret.Shape,this.ball.x=0,this.ball.y=-5,this.ballVy=0,this.ballVx=5;var t=this.ball.graphics;t.beginFill(16776960),t.drawCircle(0,0,BALL_RADIUS),t.lineStyle(1.5,16777215),t.moveTo(0,0);for(var e=0;720>e;e++){var r=e*Math.PI/180,n=BALL_RADIUS*e/720,a=0+n*Math.cos(r),o=0+n*Math.sin(r);t.lineTo(a,o)}t.endFill(),this.world.addChild(this.ball)},e.prototype.updateBall=function(){var t=this;this.distance=this.ball.x,this.ball.x+=this.ballVx,this.ball.y+=this.ballVy,this.ball.rotation+=30;var e,r=this.ball.getTransformedBounds(this.world),n=r.bottom,a=new egret.Rectangle;this.platforms.forEach(function(o){if(o.getTransformedBounds(t.world,a),a.intersects(r)){var i=(a.top+a.bottom)/2;if(i>=n){e=!0;var s=a.top-t.ball.width/2;t.ballVy=Math.min((s-t.ball.y)/2,t.ballVy),t.ballVy<-BALL_RADIUS&&console.log("DEATH "+t.ballVy)}}}),e?this.jumpCount=0:this.ballVy<0?this.ballVy+=.15:this.ballVy+=.6,(e||this.jumpCount<2)&&this.tapped&&(this.ballVy=-5,this.ball.y+=this.ballVy,this.jumpCount++),this.ballVy=limit(this.ballVy,-7,7),this.tapped=!1},e.prototype.createBlocks=function(){this.lastDrawnX=-3*this.width/2,this.lastDrawnY=0;for(var t=random(100,150),e=0;t>e;e++)this.createBlock(0,random(-1,1),24)},e.prototype.updateBlocks=function(){this.eraseBlocksOutOfCamera(),this.generateNewBlocks()},e.prototype.eraseBlocksOutOfCamera=function(){var t=this,e=this.cameraX-this.width/2;this.platforms=this.platforms.filter(function(r){var n=r.x+r.width,a=n>=e;return a||t.world.removeChild(r),a})},e.prototype.drawPlatformGenerationMode=function(){var t=[PlatformGenerationMode.Flat,PlatformGenerationMode.SlopeDescent,PlatformGenerationMode.SlopeAscent,PlatformGenerationMode.LevelsAscent,PlatformGenerationMode.LevelsDescnet,PlatformGenerationMode.Cliff,PlatformGenerationMode.Pits,PlatformGenerationMode.LargePit],e=randomInt(0,t.length-1);return t[e]},e.prototype.generateNewBlocks=function(){for(var t=this.cameraX+this.width;this.lastDrawnX<t;){var e=this.drawPlatformGenerationMode();switch(e){case PlatformGenerationMode.Flat:for(var r=random(10,50),n=0;r>n;n++)this.createBlock(0,random(-1,1),32);break;case PlatformGenerationMode.SlopeDescent:for(var a=random(10,20),o=random(7,10),n=0;a>n;n++)this.createBlock(0,o/2+random(-1,1),16,!1),this.createBlock(0,o/2+random(-1,1),16,!0);case PlatformGenerationMode.SlopeAscent:for(var i=random(10,20),s=random(-10,-7),n=0;i>n;n++)this.createBlock(0,s/2+random(-1,1),16,!1),this.createBlock(0,s/2+random(-1,1),16,!0);break;case PlatformGenerationMode.LevelsAscent:for(var l=randomInt(3,7),s=-random(32,48),n=0;l>n;n++)this.createBlock(0,s+random(-1,1),96);break;case PlatformGenerationMode.LevelsDescnet:for(var c=randomInt(1,2),o=random(32,48),n=0;c>n;n++)this.createBlock(0,o+random(-1,1),96);break;case PlatformGenerationMode.Cliff:this.lastDrawnX+=random(150,200),this.lastDrawnY+=random(100,200);break;case PlatformGenerationMode.Pits:for(var h=randomInt(3,7),n=0;h>n;n++)this.createBlock(0,random(-5,5),32),this.lastDrawnX+=64;break;case PlatformGenerationMode.LargePit:for(var d=(randomInt(1,3),0);d<name;d++)this.createBlock(0,randomInt(-5,5),32*randomInt(1,3)),this.lastDrawnX+=random(150,300)}}},e.prototype.currentColor=function(t){void 0===t&&(t=!1);var e=this.colors[this.colorGenerationIndex];return t&&(this.colorGenerationIndex=(this.colorGenerationIndex+1)%this.colors.length),e},e.prototype.createBlock=function(t,e,r,n){void 0===n&&(n=!0);var a=1*-this.stage.stageHeight/3,o=1*this.stage.stageHeight/3,i=new egret.Shape;i.x=this.lastDrawnX+t,i.y=Math.max(a,Math.min(o,this.lastDrawnY+e));var s=1024,l=this.currentColor(n),c=new egret.Matrix;c.createGradientBox(r,s,1.57,0,10),i.graphics.beginGradientFill(egret.GradientType.LINEAR,[l,l],[100,50],[0,255],c),i.graphics.drawRect(0,0,r,s),i.graphics.endFill(),this.world.addChild(i),this.platforms.push(i),this.lastDrawnX+=i.width,this.lastDrawnY=i.y},e.prototype.updateCamera=function(){this.cameraX=this.ball.x+this.width/4,this.world.x=this.width/2-this.cameraX,this.world.y=this.height/2-50},e.prototype.tap=function(t){this.tapped=!0},e}(eui.UILayer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,r,n){function a(t){e.call(n,t)}function o(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),r.call(n))}var i=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){e.call(n,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(t,r){window.JSONParseClass.setData(t),egret.callLater(function(){e.call(n,generateEUI2)},i)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(t.indexOf(".exml")>-1){var s=t.split("/");s.pop();var l=s.join("/")+"_EUI.json";generateJSON.paths[t]?egret.callLater(function(){e.call(n,generateJSON.paths[t])},this):RES.getResByUrl(l,function(r){window.JSONParseClass.setData(r),egret.callLater(function(){e.call(n,generateJSON.paths[t])},i)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){e.call(n,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),RES.getResByUrl(t,a,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);